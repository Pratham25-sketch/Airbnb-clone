<% layout("/layouts/boilerplate.ejs")%> 
<body>
    <h1 style="text-align: center;">Listing Details</h1> <br>

    <div class="card" style="width: 33rem;border: none;margin-left: 29%;">
    <b><h5 class="card-title" style="font-size: xx-large;"><%=listing.title%></h5></b>
  <img class="card-img-top" src="<%=listing.image%>" alt="Card image cap" style="height: 25rem;width: 33rem;border: none; border-radius: 2rem;">
  <div class="card-body">  
   <ul style="margin-left: -1rem;">
   <li> <p class="card-text" style="padding-bottom: 0.5rem;">Description: <%=listing.description%></p></li>
    <li><p class="card-text" style="margin-top: 1rem;">Price: â‚¹<%= listing.price ? listing.price.toLocaleString("en-IN") : " N/A" %></p></li>
    <li><p class="card-text" style="margin-top: 1rem;">Location: <%=listing.location%></p></li>
    <li><p class="card-text" style="margin-top: 1rem;">Country: <%=listing.country%></p></li>
   </ul>
  </div>

  <br>

  <div style="display: flex;justify-content: space-evenly;font-family:Verdana, Geneva, Tahoma, sans-serif;">
        <form method="get" action="/listings/<%=listing._id%>/edit">
            <a href="/listings/<%=listing._id%>/edit" class="btn btn-dark">Edit</a>
        </form><br>
         <form method="post" action="/listings/<%=listing._id%>?_method=DELETE" onsubmit="return confirm('Are you sure you want to delete this listing?')">
             <button class="btn btn-danger">Delete</button>
        </form><br><br><br>
         <a href="/listings" style="text-decoration: none;color: #222222;margin-top: 0.4rem;"><i class="fa-sharp fa-solid fa-arrow-left"></i> Go back to listings page</a>

   </div>


</div>

  <!-- Review Section using bootstrap for form-label and form-control -->
<div class="card mt-5" style="width: 50rem; margin: 3rem auto; padding: 1.5rem; border-radius: 1rem; background-color: #f9f9f9;">
    <h3 style="text-align: center; margin-bottom: 1rem;">Leave a Review!!</h3>
    <form method="POST" action="/listings/<%= listing._id %>/reviews" novalidate class="needs-validation">
    <!-- Rating Input using bootstrap for naming classes as form-label and form-range -->
        <div class="form-group mb-3">
            <label class="form-label" for="rating" class="form-label">Rating: <span id="ratingValue">3</span>/5</label>
            <input type="range" id="rating" name="rating" min="1" max="5" value="3" class="form-range" 
                   oninput="document.getElementById('ratingValue').innerText = this.value"> 
        </div>

        <!-- Comment Input -->
        <div class="form-group mb-3">
            <label for="comment" class="form-label">Comment:</label>
            <textarea class="form-control" id="comment" name="comment" rows="8" placeholder="Write your review here..." required></textarea>

     <DIV class="invalid-feedback">Please provide a valid comment !!</DIV>
     <DIV class="valid-feedback">Comment looks good !!</DIV>
        </div>

        <!-- Submit Button -->
        <div class="form-group" style="text-align: center;">
            <button type="submit" class="btn btn-primary">Submit Review</button>
        </div>
    </form> <br><br><br>
    <div><h2>&nbsp;&nbsp;&nbsp;&nbsp; All Reviews!!</h2>

    
        <% for(let i=0;i<listing.reviews.length;i++){ %>
        <div class="card-body" style="display: inline-block;margin: 2rem; border: 1px solid black;border-radius: 2rem;">
            
      <div style="display: inline-flex;"> <img src="/pps.jpg" alt="" style="height: 3rem; width: 2.5rem;border-radius: 50%;margin: auto;">

       
      <div style="margin-left: 0.5rem;margin-top: 0.3rem;"> <b>Pratham</b><br>
        <p style="display: inline;font-size: smaller;position: relative;bottom: 0.4rem;">Los Angeles,USA</p> <br> 
      </div> 
    
    </div>
       
       <br><br>
       <% for(let j=0;j<listing.reviews[i].rating;j++){ %>
        <i class="fa-solid fa-star"></i> 
          <%   }  %> &nbsp;&nbsp;

          <b><%=listing.reviews[i].createdAt.toLocaleString()%></b>
          
          <br><br>
          
          <%=listing.reviews[i].comment%>
       



           <!-- DELETE BUTTON -->
    <form method="POST" action="/listings/<%= listing._id %>/reviews/<%= listing.reviews[i]._id %>?_method=DELETE" onsubmit="return confirm('Are you sure you want to delete this review?')" style="margin-top: 1rem;">
      <button type="submit" class="btn btn-sm btn-danger">Delete Review</button>
    </form>
       </div>
       
       <%   }  %>

   </div>
</div>



    
</body>
